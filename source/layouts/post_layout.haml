- post = current_article

- content_for(:title, "#{post.title}")
- content_for(:layout, "post")
- content_for(:itemtype, "Article")
- content_for(:back, '<a class="back-to-home" href="/">⬅ Back to Blog</a>')

- if post.data.author == "sacha"
  - author = data.authors.fetch(0)
- else
  - author = data.authors.fetch(1)


= wrap_layout :layout do
  %section.post-block
    .post-body
      = partial("partials/meta", :locals => {post: post})
              
      - if post.data.thumb
        .post-thumbnail
          %a{:href => post.url}
            %img.thumb{:src => "/images/blog/"+post.data.thumb}

      %h1.post-title{:itemprop => "name"}=post.data.title

      .post-content
        =find_and_preserve do
          =yield
    .post-share
      %h4 Share:
      .post-share-option.twitter
        :plain
          <a href="https://twitter.com/share" class="twitter-share-button" data-via="YoFolyo">Tweet</a>
          <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
      .post-share-option.gplus
        :plain
          <!-- Place this tag where you want the +1 button to render. -->
          <div class="g-plusone" data-size="medium" data-annotation="inline" data-width="200"></div>

          <!-- Place this tag after the last +1 button tag. -->
          <script type="text/javascript">
            (function() {
              var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
              po.src = 'https://apis.google.com/js/platform.js';
              var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
            })();
          </script>
      .post-share-option.facebook
        :plain
          <div id="fb-root"></div>
          <script>(function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_EN/all.js#xfbml=1&appId=449721305061869";
            fjs.parentNode.insertBefore(js, fjs);
          }(document, 'script', 'facebook-jssdk'));</script>
        :plain
          <div class="fb-like" data-width="200" data-layout="button_count" data-action="like" data-show-faces="false" data-share="false"></div>
  .post-author.post-block
    %h4.section-header About the Author
    %img.portrait{:src => "/images/#{author.avatar}"}
    .post-author-bio
      =author.bio
      You can find him on 
      %a{:href => 'http://twitter.com/'+author.twitter} Twitter
      and&nbsp;
      %a{:href => author.gplus+'?rel=author'}> Google Plus
      \.


  / .blog-featured
  /   %h4.blog-header Read This Next
  /   - featured_articles = blog.articles.select{|item| item.metadata[:page]["featured"] rescue false} # get all featured articles
  /   - featured_articles = featured_articles.delete_if{|item| item == post} # remove the current article
  /   - featured = featured_articles.sample() # pick one at random   
  /   =partial("partials/summary", :locals=>{post:featured})

  .blog-pagination.post-block
    .pagination-prev
      - prev_article = post.previous_article
      - if prev_article
        %h4.section-header Previous Article
        %a.prev{:href => "#{prev_article.url}", :title => "Previous Post: #{prev_article.title}"}
          %span
            «
            =prev_article.title
    .pagination-next
      - next_article = post.next_article
      - if next_article
        %h4.section-header Next Article
        %a.next{:href => "#{next_article.url}", :title => "next Post: #{next_article.title}"}
          %span
            =next_article.title
            »

  - if ENV["SHOW_COMMENTS"]
    .blog-comments
      %h4.blog-header Comments
      :plain
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'folyoblog'; // required: replace example with your forum shortname
            var disqus_identifier = '#{post.slug}';
            function disqus_config() {
                this.callbacks.onNewComment = [function() { 
                  trackEvent('New Comment'); }];
            }
            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>   